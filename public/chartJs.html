<!doctype html>
<html>
<head>
    <title> Animation Callbacks </title>
    <script src="../lib/chartJs/Chart.min.js"></script>
    <script src="../lib/chartJs/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body>
<div style="width: 75%;">
    <canvas id="canvas"></canvas>
</div>
<br>
<br>
<button id="randomizeData">Randomize Data</button>
<script>
        //value for x-axis
        var arrayLabel = ["calm", "happy", "angry", "disgust"];

        //colours for each bar
        var arrayColor = ['red', 'green', 'yellow', 'blue'];

        //Let's arrayData[] be the initial data set
        var arrayData = [0.1, 0.4, 0.3, 0.6];

        function sortAll(myData){
            var arrayOfObj = arrayLabel.map(function(d, i) {
              return {
                label: d,
                data: myData[i] || 0,
                color: arrayColor[i] || 0
              };
            });

            var sortedArrayOfObj = arrayOfObj.sort(function(a, b) {
              return b.data - a.data;
            });

            var newArrayLabel = [];
            var newArrayData = [];
            var newArrayColor = [];
            sortedArrayOfObj.forEach(function(d){
              newArrayLabel.push(d.label);
              newArrayData.push(d.data);
              newArrayColor.push(d.color);
            });
            return {
                newLabel: newArrayLabel,
                newData: newArrayData,
                newColor: newArrayColor
            }
        }


        /*Creating the bar chart*/
        var ctx = document.getElementById("canvas");
        var barChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: arrayLabel,
            datasets: [{
              backgroundColor: arrayColor,
              label: 'Prediction',
              data: arrayData
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true,
                  min: 0,
                  max: 1,
                  stepSize: 0.5,
                }
              }]
            },
            animation: {
                duration: 0,
                easing: 'linear',
                onProgress: function(animation) {

                },
                onComplete: function() {
                    window.setTimeout(function() {

                    }, 0);
                }
            }
          }
        });

        /*Function to update the bar chart*/
        function updateBarGraph(chart, labels, color, data) {
          //chart.data.datasets.pop();
          //chart.data.datasets.push({
            //label: label,
            //backgroundColor: color,
            //data: data
          //});
          chart.data.labels = labels;
          chart.data.datasets[0].data = data;
          chart.data.datasets[0].backgroundColor = color
          chart.update();
        }

        /*Updating the bar chart with updated data in every second. */
        setInterval(function() {
          arrayData = [Math.random(), Math.random(), Math.random(), Math.random()];
          var sortedData = sortAll(arrayData);
          arrayData = sortedData.newData;
          arrayLabel = sortedData.newLabel;
          arrayColor = sortedData.newColor;
          updateBarGraph(barChart, arrayLabel, arrayColor, arrayData);
        }, 5000);

        //window.onload = function() {
        //  var ctx = document.getElementById('canvas').getContext('2d');
        //  window.myLine = new Chart(ctx, config);
        //};

        //document.getElementById('randomizeData').addEventListener('click', function() {
        //  config.data.datasets.forEach(function(dataset) {
        //      dataset.data = dataset.data.map(function() {
        //          return randomScalingFactor();
        //      });
        //  });

        //  window.myLine.update();
        //});
    </script>
</body>

</html>